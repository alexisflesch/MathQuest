
> backend@1.0.0 test
> jest

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

‚úî Generated Prisma Client (v6.7.0) to ./src/db/generated/client in 67ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Want to react to database changes in your app as they happen? Discover how with Pulse: https://pris.ly/tip-1-pulse

Test setup complete, using port 4087
Database URL: postgresql://postgre:Phuf0pohooFee8auohFahk7vChae4Iv0wiem5voT@localhost:5432/mathquest_test
Redis URL: redis://localhost:6379
Cleaning test database...
Database cleaned successfully
Inserted default test questions.
Seeded integration teacher, template, questions, and game instance.
PASS tests/integration/tournament2.test.ts (46.593 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-22 13:26:03.549] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:03.565] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:03.711] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "eca2a728-13d1-404f-b961-b8f44d39d89d",
        "accessCode": "YLR9NL"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:03.903] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "d8Pk-VTRzkHHqEbMAAAC",
        "user": {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "username": "p1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.347] [32mINFO [0m [GameHandlers] {
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.348] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.354] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "tr5X87Q2cmqocEybAAAD",
        "user": {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "username": "p2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.354] [32mINFO [0m [GameHandlers] {
        "socketId": "tr5X87Q2cmqocEybAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.355] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "tr5X87Q2cmqocEybAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.357] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_YLR9NL",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.361] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_YLR9NL",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.361] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_YLR9NL",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.361] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_YLR9NL",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.362] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_YLR9NL",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.362] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_YLR9NL",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.362] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_YLR9NL",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.363] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_YLR9NL",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.364] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_YLR9NL",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "eca2a728-13d1-404f-b961-b8f44d39d89d",
          "accessCode": "YLR9NL",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.366] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_YLR9NL",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "eca2a728-13d1-404f-b961-b8f44d39d89d",
          "accessCode": "YLR9NL",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.367] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_YLR9NL",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "eca2a728-13d1-404f-b961-b8f44d39d89d",
          "accessCode": "YLR9NL",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.367] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_YLR9NL",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "eca2a728-13d1-404f-b961-b8f44d39d89d",
          "accessCode": "YLR9NL",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.372] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.373] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.373] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.373] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.393] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "eca2a728-13d1-404f-b961-b8f44d39d89d",
        "templateId": "385464f2-b08c-40a2-84f7-dafd548b210a",
        "initiator": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "YLR9NL",
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.597] [32mINFO [0m [GameStateService] {
        "accessCode": "YLR9NL"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:04.606] [32mINFO [0m [TournamentHandler] {
        "room": "live_YLR9NL",
        "duration": 5,
        "accessCode": "YLR9NL",
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.609] [32mINFO [0m [GameStateService] {
        "accessCode": "YLR9NL"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.619] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.623] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.623] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.625] [32mINFO [0m [GameStateService] {
        "accessCode": "YLR9NL"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.626] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "room": "live_YLR9NL",
        "socketIds": [
          "d8Pk-VTRzkHHqEbMAAAC",
          "tr5X87Q2cmqocEybAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.626] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.626] [32mINFO [0m [SharedGameFlow] {
        "room": "live_YLR9NL",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-22T11:26:00.819Z",
            "updatedAt": "2025-05-22T11:26:03.658Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.627] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.630] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.631] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.631] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.632] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.633] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "tr5X87Q2cmqocEybAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.633] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "tr5X87Q2cmqocEybAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.634] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "tr5X87Q2cmqocEybAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.634] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "tr5X87Q2cmqocEybAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.648] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.648] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.656] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:09.657] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "YLR9NL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.629] [32mINFO [0m [SharedGameFlow] {
        "room": "live_YLR9NL",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.631] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.631] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.642] [32mINFO [0m [GameStateService] {
        "accessCode": "YLR9NL",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.643] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.646] [32mINFO [0m [GameStateService] {
        "accessCode": "YLR9NL",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "username": "p1",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "username": "p2",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:327:17)

    console.log
      [2025-05-22 13:26:11.675] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "2d12e1cc-618f-4249-b301-f363d221c202",
        "accessCode": "53M45U"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.819] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "rFM8duhEqeQjydiNAAAG",
        "user": {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "username": "p1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.819] [32mINFO [0m [GameHandlers] {
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.819] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.821] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "zkEP1fiIsj9xUdD7AAAH",
        "user": {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "username": "p2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.821] [32mINFO [0m [GameHandlers] {
        "socketId": "zkEP1fiIsj9xUdD7AAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.821] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "zkEP1fiIsj9xUdD7AAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_53M45U",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_53M45U",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_53M45U",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_53M45U",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_53M45U",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_53M45U",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.823] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_53M45U",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.823] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_53M45U",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.823] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_53M45U",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "2d12e1cc-618f-4249-b301-f363d221c202",
          "accessCode": "53M45U",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.824] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_53M45U",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "2d12e1cc-618f-4249-b301-f363d221c202",
          "accessCode": "53M45U",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.824] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_53M45U",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "2d12e1cc-618f-4249-b301-f363d221c202",
          "accessCode": "53M45U",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.824] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_53M45U",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "2d12e1cc-618f-4249-b301-f363d221c202",
          "accessCode": "53M45U",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.826] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.826] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.826] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.826] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:11.835] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "2d12e1cc-618f-4249-b301-f363d221c202",
        "templateId": "1b20631d-6f6f-4d7c-befe-843d0b008c90",
        "initiator": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "53M45U",
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:12.037] [32mINFO [0m [GameStateService] {
        "accessCode": "53M45U"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:12.046] [32mINFO [0m [TournamentHandler] {
        "room": "live_53M45U",
        "duration": 5,
        "accessCode": "53M45U",
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:13.645] [32mINFO [0m [SharedGameFlow] {
        "room": "live_YLR9NL",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:13.647] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:13.648] [32mINFO [0m [SharedGameFlow] {
        "room": "live_YLR9NL",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:13.649] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "YLR9NL",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.050] [32mINFO [0m [GameStateService] {
        "accessCode": "53M45U"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.063] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.064] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.065] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.068] [32mINFO [0m [GameStateService] {
        "accessCode": "53M45U"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.069] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "room": "live_53M45U",
        "socketIds": [
          "rFM8duhEqeQjydiNAAAG",
          "zkEP1fiIsj9xUdD7AAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.069] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.070] [32mINFO [0m [SharedGameFlow] {
        "room": "live_53M45U",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-22T11:26:00.819Z",
            "updatedAt": "2025-05-22T11:26:03.658Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.070] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.073] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.073] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.073] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.074] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.074] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "zkEP1fiIsj9xUdD7AAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.075] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "zkEP1fiIsj9xUdD7AAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.075] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "zkEP1fiIsj9xUdD7AAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.075] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "zkEP1fiIsj9xUdD7AAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.080] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:17.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "53M45U",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.071] [32mINFO [0m [SharedGameFlow] {
        "room": "live_53M45U",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.073] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.073] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.083] [32mINFO [0m [GameStateService] {
        "accessCode": "53M45U",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.084] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.086] [32mINFO [0m [GameStateService] {
        "accessCode": "53M45U",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "username": "p1",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "username": "p2",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:442:17)

    console.log
      [2025-05-22 13:26:19.109] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "7defe7c7-092b-4590-9422-259c61d0f84d",
        "accessCode": "N54T9H"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.243] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "kwif1Px1WF68dicvAAAK",
        "user": {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "username": "p1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.243] [32mINFO [0m [GameHandlers] {
        "socketId": "kwif1Px1WF68dicvAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.243] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "kwif1Px1WF68dicvAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.244] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "qcI6RCBjf1fE24W4AAAL",
        "user": {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "username": "p2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.244] [32mINFO [0m [GameHandlers] {
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.245] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.245] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_N54T9H",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.245] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_N54T9H",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.245] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_N54T9H",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.245] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_N54T9H",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.246] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_N54T9H",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.246] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_N54T9H",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.246] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_N54T9H",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.246] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_N54T9H",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_N54T9H",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7defe7c7-092b-4590-9422-259c61d0f84d",
          "accessCode": "N54T9H",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_N54T9H",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7defe7c7-092b-4590-9422-259c61d0f84d",
          "accessCode": "N54T9H",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_N54T9H",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7defe7c7-092b-4590-9422-259c61d0f84d",
          "accessCode": "N54T9H",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_N54T9H",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7defe7c7-092b-4590-9422-259c61d0f84d",
          "accessCode": "N54T9H",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.250] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.250] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.250] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.250] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.260] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "7defe7c7-092b-4590-9422-259c61d0f84d",
        "templateId": "3a12a7c2-6588-42c8-aba5-80de2ba4197a",
        "initiator": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "N54T9H",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.463] [32mINFO [0m [GameStateService] {
        "accessCode": "N54T9H"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:19.476] [32mINFO [0m [TournamentHandler] {
        "room": "live_N54T9H",
        "duration": 5,
        "accessCode": "N54T9H",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:21.086] [32mINFO [0m [SharedGameFlow] {
        "room": "live_53M45U",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:21.088] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:21.089] [32mINFO [0m [SharedGameFlow] {
        "room": "live_53M45U",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:21.089] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "53M45U",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.485] [32mINFO [0m [GameStateService] {
        "accessCode": "N54T9H"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.495] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.496] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.496] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.499] [32mINFO [0m [GameStateService] {
        "accessCode": "N54T9H"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.500] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "room": "live_N54T9H",
        "socketIds": [
          "kwif1Px1WF68dicvAAAK",
          "qcI6RCBjf1fE24W4AAAL"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.500] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.500] [32mINFO [0m [SharedGameFlow] {
        "room": "live_N54T9H",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-22T11:26:00.819Z",
            "updatedAt": "2025-05-22T11:26:03.658Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.501] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.504] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.505] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.505] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.505] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.505] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.507] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.507] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.508] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.512] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.512] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.513] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:24.514] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:26.502] [32mINFO [0m [SharedGameFlow] {
        "room": "live_N54T9H",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:26.503] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:26.503] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:26.507] [32mINFO [0m [GameStateService] {
        "accessCode": "N54T9H",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:26.507] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.509] [32mINFO [0m [SharedGameFlow] {
        "room": "live_N54T9H",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.511] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.517] [32mINFO [0m [GameStateService] {
        "accessCode": "N54T9H"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.518] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.518] [32mINFO [0m [SharedGameFlow] {
        "room": "live_N54T9H",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 0,
            "createdAt": "2025-05-22T11:26:00.819Z",
            "updatedAt": "2025-05-22T11:26:00.819Z"
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.519] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.521] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.523] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.524] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.524] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.526] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.526] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.526] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.527] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:28.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N54T9H",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.520] [32mINFO [0m [SharedGameFlow] {
        "room": "live_N54T9H",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.523] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.523] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.539] [32mINFO [0m [GameStateService] {
        "accessCode": "N54T9H",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.540] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.553] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "dab156b3-22d9-45f0-b68d-71acbec88f68",
        "accessCode": "62KWWK"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.699] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "4QGG6v3VShkkRHPsAAAO",
        "user": {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "username": "p1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.699] [32mINFO [0m [GameHandlers] {
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.701] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.702] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "JCY5xF6UGva4o5vSAAAP",
        "user": {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "username": "p2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.702] [32mINFO [0m [GameHandlers] {
        "socketId": "JCY5xF6UGva4o5vSAAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.702] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "JCY5xF6UGva4o5vSAAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.704] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.704] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.705] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_62KWWK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.705] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_62KWWK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.705] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.705] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.705] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_62KWWK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.705] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_62KWWK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.707] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "dab156b3-22d9-45f0-b68d-71acbec88f68",
          "accessCode": "62KWWK",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.708] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "dab156b3-22d9-45f0-b68d-71acbec88f68",
          "accessCode": "62KWWK",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.708] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "dab156b3-22d9-45f0-b68d-71acbec88f68",
          "accessCode": "62KWWK",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.708] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "dab156b3-22d9-45f0-b68d-71acbec88f68",
          "accessCode": "62KWWK",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.710] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.710] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.710] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.710] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.718] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "dab156b3-22d9-45f0-b68d-71acbec88f68",
        "templateId": "72f8ed98-e86d-42ec-8b25-c3b08856b176",
        "initiator": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "62KWWK",
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.921] [32mINFO [0m [GameStateService] {
        "accessCode": "62KWWK"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:30.933] [32mINFO [0m [TournamentHandler] {
        "room": "live_62KWWK",
        "duration": 5,
        "accessCode": "62KWWK",
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:32.041] [32mINFO [0m [SharedGameFlow] {
        "room": "live_N54T9H",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:32.043] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:32.044] [32mINFO [0m [SharedGameFlow] {
        "room": "live_N54T9H",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:32.045] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N54T9H",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.939] [32mINFO [0m [GameStateService] {
        "accessCode": "62KWWK"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.951] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.951] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.952] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.955] [32mINFO [0m [GameStateService] {
        "accessCode": "62KWWK"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.955] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "room": "live_62KWWK",
        "socketIds": [
          "4QGG6v3VShkkRHPsAAAO",
          "JCY5xF6UGva4o5vSAAAP"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.955] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.955] [32mINFO [0m [SharedGameFlow] {
        "room": "live_62KWWK",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-22T11:26:00.819Z",
            "updatedAt": "2025-05-22T11:26:03.658Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.956] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.957] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.957] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "JCY5xF6UGva4o5vSAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.961] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "JCY5xF6UGva4o5vSAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.961] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "JCY5xF6UGva4o5vSAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.961] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "JCY5xF6UGva4o5vSAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.969] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.969] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.970] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:35.971] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:37.957] [32mINFO [0m [SharedGameFlow] {
        "room": "live_62KWWK",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:37.959] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:37.960] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:37.968] [32mINFO [0m [GameStateService] {
        "accessCode": "62KWWK",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:37.969] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.245] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ZrHlDJP_r8gD83gZAAAR",
        "user": {
          "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
          "username": "p3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.246] [32mINFO [0m [GameHandlers] {
        "socketId": "ZrHlDJP_r8gD83gZAAAR"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.246] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ZrHlDJP_r8gD83gZAAAR"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "room": "live_62KWWK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.249] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "room": "live_62KWWK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.256] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "dab156b3-22d9-45f0-b68d-71acbec88f68",
          "accessCode": "62KWWK",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1747913195952,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.256] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "room": "live_62KWWK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "dab156b3-22d9-45f0-b68d-71acbec88f68",
          "accessCode": "62KWWK",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1747913195952,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.258] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.258] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.260] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "socketId": "ZrHlDJP_r8gD83gZAAAR",
        "liveRoom": "live_62KWWK",
        "socketIds": [
          "4QGG6v3VShkkRHPsAAAO",
          "JCY5xF6UGva4o5vSAAAP",
          "ZrHlDJP_r8gD83gZAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.260] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.260] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.260] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "socketId": "ZrHlDJP_r8gD83gZAAAR",
        "liveRoom": "live_62KWWK",
        "socketIds": [
          "4QGG6v3VShkkRHPsAAAO",
          "JCY5xF6UGva4o5vSAAAP",
          "ZrHlDJP_r8gD83gZAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.261] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:38.261] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:39.970] [32mINFO [0m [SharedGameFlow] {
        "room": "live_62KWWK",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:39.972] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:39.976] [32mINFO [0m [GameStateService] {
        "accessCode": "62KWWK"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:39.977] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:39.977] [32mINFO [0m [SharedGameFlow] {
        "room": "live_62KWWK",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 0,
            "createdAt": "2025-05-22T11:26:00.819Z",
            "updatedAt": "2025-05-22T11:26:00.819Z"
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:39.978] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:41.979] [32mINFO [0m [SharedGameFlow] {
        "room": "live_62KWWK",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:41.982] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:41.982] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:41.988] [32mINFO [0m [GameStateService] {
        "accessCode": "62KWWK",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:41.989] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.490] [32mINFO [0m [SharedGameFlow] {
        "room": "live_62KWWK",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.491] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.491] [32mINFO [0m [SharedGameFlow] {
        "room": "live_62KWWK",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.492] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "62KWWK",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.496] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "ZrHlDJP_r8gD83gZAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.496] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "ZrHlDJP_r8gD83gZAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.497] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "ZrHlDJP_r8gD83gZAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.497] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "ZrHlDJP_r8gD83gZAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.499] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.499] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "62KWWK",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      socket3 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:790:33)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:74:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      [2025-05-22 13:26:43.511] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ZrHlDJP_r8gD83gZAAAR",
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "accessCode": "62KWWK",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.516] [32mINFO [0m [DisconnectHandler] {
        "socketId": "4QGG6v3VShkkRHPsAAAO",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "accessCode": "62KWWK",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.517] [32mINFO [0m [DisconnectHandler] {
        "socketId": "JCY5xF6UGva4o5vSAAAP",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "accessCode": "62KWWK",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.521] [32mINFO [0m [DisconnectHandler] {
        "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
        "accessCode": "62KWWK",
        "socketId": "ZrHlDJP_r8gD83gZAAAR"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.524] [32mINFO [0m [DisconnectHandler] {
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "accessCode": "62KWWK",
        "socketId": "4QGG6v3VShkkRHPsAAAO"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.524] [32mINFO [0m [DisconnectHandler] {
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "accessCode": "62KWWK",
        "socketId": "JCY5xF6UGva4o5vSAAAP"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.525] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "104a6477-49b6-4a0d-aca7-adf150fd6b76",
          "socketId": "ZrHlDJP_r8gD83gZAAAR"
        },
        "room": "live_62KWWK"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.525] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "socketId": "4QGG6v3VShkkRHPsAAAO"
        },
        "room": "live_62KWWK"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:43.525] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "socketId": "JCY5xF6UGva4o5vSAAAP"
        },
        "room": "live_62KWWK"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:124:21)

    console.log
      [2025-05-22 13:26:44.013] [32mINFO [0m [DisconnectHandler] {
        "socketId": "d8Pk-VTRzkHHqEbMAAAC",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "accessCode": "YLR9NL",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:26:44.015] [32mINFO [0m [DisconnectHandler] {
        "socketId": "tr5X87Q2cmqocEybAAAD",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "accessCode": "YLR9NL",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:26:44.016] [32mINFO [0m [DisconnectHandler] {
        "socketId": "rFM8duhEqeQjydiNAAAG",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "accessCode": "53M45U",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:26:44.017] [32mINFO [0m [DisconnectHandler] {
        "socketId": "zkEP1fiIsj9xUdD7AAAH",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "accessCode": "53M45U",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:26:44.017] [32mINFO [0m [DisconnectHandler] {
        "socketId": "kwif1Px1WF68dicvAAAK",
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "accessCode": "N54T9H",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:26:44.018] [32mINFO [0m [DisconnectHandler] {
        "socketId": "qcI6RCBjf1fE24W4AAAL",
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "accessCode": "N54T9H",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament2.test.ts:136:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:144:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:164:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:170:17)

    console.log
      [2025-05-22 13:26:44.035] [32mINFO [0m [DisconnectHandler] {
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "accessCode": "YLR9NL",
        "socketId": "d8Pk-VTRzkHHqEbMAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.035] [32mINFO [0m [DisconnectHandler] {
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "accessCode": "YLR9NL",
        "socketId": "tr5X87Q2cmqocEybAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.035] [32mINFO [0m [DisconnectHandler] {
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "accessCode": "53M45U",
        "socketId": "rFM8duhEqeQjydiNAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.035] [32mINFO [0m [DisconnectHandler] {
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "accessCode": "53M45U",
        "socketId": "zkEP1fiIsj9xUdD7AAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.035] [32mINFO [0m [DisconnectHandler] {
        "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
        "accessCode": "N54T9H",
        "socketId": "kwif1Px1WF68dicvAAAK"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.035] [32mINFO [0m [DisconnectHandler] {
        "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
        "accessCode": "N54T9H",
        "socketId": "qcI6RCBjf1fE24W4AAAL"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.038] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "socketId": "d8Pk-VTRzkHHqEbMAAAC"
        },
        "room": "live_YLR9NL"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.038] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "socketId": "tr5X87Q2cmqocEybAAAD"
        },
        "room": "live_YLR9NL"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.038] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "socketId": "rFM8duhEqeQjydiNAAAG"
        },
        "room": "live_53M45U"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.038] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "socketId": "zkEP1fiIsj9xUdD7AAAH"
        },
        "room": "live_53M45U"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.039] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "dfa523fc-405d-4d5e-bbec-ee6c059ce77b",
          "socketId": "kwif1Px1WF68dicvAAAK"
        },
        "room": "live_N54T9H"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:44.039] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "9aecc68a-ca2a-4a65-8d61-bbd85e9d0377",
          "socketId": "qcI6RCBjf1fE24W4AAAL"
        },
        "room": "live_N54T9H"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:174:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:177:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:185:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:189:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:200:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:212:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      222 |             }
      223 |         } catch (e: any) {
    > 224 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      225 |         }
      226 |
      227 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament2.test.ts:224:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:228:17)

PASS tests/integration/tournament.test.ts (19.477 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-22 13:26:48.174] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.248] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.286] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "f942f77f-196d-4d24-871c-c9d38c1cb336",
        "accessCode": "MFKD8P"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.432] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "LWC4Z3XcFjWP5XkkAAAC",
        "user": {
          "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
          "username": "p1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.437] [32mINFO [0m [GameHandlers] {
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.438] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.441] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "uYoCNhoB10vgXSq1AAAD",
        "user": {
          "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
          "username": "p2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.441] [32mINFO [0m [GameHandlers] {
        "socketId": "uYoCNhoB10vgXSq1AAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.441] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "uYoCNhoB10vgXSq1AAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MFKD8P",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MFKD8P",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MFKD8P",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MFKD8P",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.443] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MFKD8P",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.443] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MFKD8P",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.443] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MFKD8P",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.443] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MFKD8P",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.444] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MFKD8P",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f942f77f-196d-4d24-871c-c9d38c1cb336",
          "accessCode": "MFKD8P",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.444] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MFKD8P",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f942f77f-196d-4d24-871c-c9d38c1cb336",
          "accessCode": "MFKD8P",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.445] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MFKD8P",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f942f77f-196d-4d24-871c-c9d38c1cb336",
          "accessCode": "MFKD8P",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.445] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MFKD8P",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f942f77f-196d-4d24-871c-c9d38c1cb336",
          "accessCode": "MFKD8P",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.447] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.447] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.447] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.447] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.458] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "f942f77f-196d-4d24-871c-c9d38c1cb336",
        "templateId": "9c8d331b-682f-4399-89d6-bfde93cd6d38",
        "initiator": "005cea73-abee-4b03-89e8-fd9e46777979",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "MFKD8P",
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.661] [32mINFO [0m [GameStateService] {
        "accessCode": "MFKD8P"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:48.669] [32mINFO [0m [TournamentHandler] {
        "room": "live_MFKD8P",
        "duration": 5,
        "accessCode": "MFKD8P",
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.674] [32mINFO [0m [GameStateService] {
        "accessCode": "MFKD8P"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.686] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.686] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.687] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.690] [32mINFO [0m [GameStateService] {
        "accessCode": "MFKD8P"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.690] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "room": "live_MFKD8P",
        "socketIds": [
          "LWC4Z3XcFjWP5XkkAAAC",
          "uYoCNhoB10vgXSq1AAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.690] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.690] [32mINFO [0m [SharedGameFlow] {
        "room": "live_MFKD8P",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-22T11:26:48.243Z",
            "updatedAt": "2025-05-22T11:26:48.260Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.691] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.693] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.693] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.693] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.693] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.694] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "uYoCNhoB10vgXSq1AAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.694] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "uYoCNhoB10vgXSq1AAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.694] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "uYoCNhoB10vgXSq1AAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.694] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "uYoCNhoB10vgXSq1AAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.703] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.703] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.703] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:53.710] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MFKD8P",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.693] [32mINFO [0m [SharedGameFlow] {
        "room": "live_MFKD8P",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.694] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.694] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.702] [32mINFO [0m [GameStateService] {
        "accessCode": "MFKD8P",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.703] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.708] [32mINFO [0m [GameStateService] {
        "accessCode": "MFKD8P",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
          "username": "p1",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
          "username": "p2",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:331:17)

    console.log
      [2025-05-22 13:26:55.723] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "76265d58-51d6-44bc-a6ef-313f75a9c3ca",
        "accessCode": "MVN4S7"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.872] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "FI6jcCxm_PgThUjpAAAG",
        "user": {
          "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
          "username": "p1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.872] [32mINFO [0m [GameHandlers] {
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.872] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.873] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "nx5ZoF_PwunT58DwAAAH",
        "user": {
          "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
          "username": "p2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.873] [32mINFO [0m [GameHandlers] {
        "socketId": "nx5ZoF_PwunT58DwAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.874] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "nx5ZoF_PwunT58DwAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.874] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MVN4S7",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.874] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MVN4S7",
        "playMode": "tournament",
        "username": "p1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.874] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MVN4S7",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.874] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MVN4S7",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.875] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MVN4S7",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.875] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MVN4S7",
        "playMode": "tournament",
        "username": "p2"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.875] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MVN4S7",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.875] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MVN4S7",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.875] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MVN4S7",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "76265d58-51d6-44bc-a6ef-313f75a9c3ca",
          "accessCode": "MVN4S7",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.876] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "room": "live_MVN4S7",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "76265d58-51d6-44bc-a6ef-313f75a9c3ca",
          "accessCode": "MVN4S7",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.876] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MVN4S7",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "76265d58-51d6-44bc-a6ef-313f75a9c3ca",
          "accessCode": "MVN4S7",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.876] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "room": "live_MVN4S7",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "76265d58-51d6-44bc-a6ef-313f75a9c3ca",
          "accessCode": "MVN4S7",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.878] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.878] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.878] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.878] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:55.889] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "76265d58-51d6-44bc-a6ef-313f75a9c3ca",
        "templateId": "ba15b039-f94e-43d6-8848-476e13bbe075",
        "initiator": "005cea73-abee-4b03-89e8-fd9e46777979",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "MVN4S7",
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:56.093] [32mINFO [0m [GameStateService] {
        "accessCode": "MVN4S7"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:56.106] [32mINFO [0m [TournamentHandler] {
        "room": "live_MVN4S7",
        "duration": 5,
        "accessCode": "MVN4S7",
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:57.705] [32mINFO [0m [SharedGameFlow] {
        "room": "live_MFKD8P",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:57.706] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:57.706] [32mINFO [0m [SharedGameFlow] {
        "room": "live_MFKD8P",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:26:57.707] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MFKD8P",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.113] [32mINFO [0m [GameStateService] {
        "accessCode": "MVN4S7"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.128] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.129] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.129] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.131] [32mINFO [0m [GameStateService] {
        "accessCode": "MVN4S7"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.132] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "room": "live_MVN4S7",
        "socketIds": [
          "FI6jcCxm_PgThUjpAAAG",
          "nx5ZoF_PwunT58DwAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.132] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.132] [32mINFO [0m [SharedGameFlow] {
        "room": "live_MVN4S7",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-22T11:26:48.243Z",
            "updatedAt": "2025-05-22T11:26:48.260Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.133] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.134] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.135] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.135] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.135] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.136] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "nx5ZoF_PwunT58DwAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.136] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "nx5ZoF_PwunT58DwAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.136] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "nx5ZoF_PwunT58DwAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.136] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "nx5ZoF_PwunT58DwAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.139] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.143] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.143] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.143] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:01.143] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "MVN4S7",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.134] [32mINFO [0m [SharedGameFlow] {
        "room": "live_MVN4S7",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.136] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.136] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.142] [32mINFO [0m [GameStateService] {
        "accessCode": "MVN4S7",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.142] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.150] [32mINFO [0m [GameStateService] {
        "accessCode": "MVN4S7",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
          "username": "p1",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
          "username": "p2",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:446:17)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament.test.ts:78:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament.test.ts:86:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:91:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:101:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:117:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament.test.ts:86:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:91:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:101:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:117:21)

    console.log
      [2025-05-22 13:27:03.158] [32mINFO [0m [DisconnectHandler] {
        "socketId": "FI6jcCxm_PgThUjpAAAG",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "accessCode": "MVN4S7",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.159] [32mINFO [0m [DisconnectHandler] {
        "socketId": "nx5ZoF_PwunT58DwAAAH",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "accessCode": "MVN4S7",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.161] [32mINFO [0m [DisconnectHandler] {
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "accessCode": "MVN4S7",
        "socketId": "FI6jcCxm_PgThUjpAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.161] [32mINFO [0m [DisconnectHandler] {
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "accessCode": "MVN4S7",
        "socketId": "nx5ZoF_PwunT58DwAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.162] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
          "socketId": "FI6jcCxm_PgThUjpAAAG"
        },
        "room": "live_MVN4S7"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.162] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
          "socketId": "nx5ZoF_PwunT58DwAAAH"
        },
        "room": "live_MVN4S7"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:128:21)

    console.log
      [2025-05-22 13:27:03.659] [32mINFO [0m [DisconnectHandler] {
        "socketId": "LWC4Z3XcFjWP5XkkAAAC",
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "accessCode": "MFKD8P",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:27:03.660] [32mINFO [0m [DisconnectHandler] {
        "socketId": "uYoCNhoB10vgXSq1AAAD",
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "accessCode": "MFKD8P",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:27:03.665] [32mINFO [0m [DisconnectHandler] {
        "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
        "accessCode": "MFKD8P",
        "socketId": "LWC4Z3XcFjWP5XkkAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.666] [32mINFO [0m [DisconnectHandler] {
        "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
        "accessCode": "MFKD8P",
        "socketId": "uYoCNhoB10vgXSq1AAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament.test.ts:140:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:148:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament.test.ts:168:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament.test.ts:174:17)

    console.log
      [2025-05-22 13:27:03.669] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "005cea73-abee-4b03-89e8-fd9e46777979",
          "socketId": "LWC4Z3XcFjWP5XkkAAAC"
        },
        "room": "live_MFKD8P"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:03.670] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b3c7e32e-cc3a-40ed-bdb8-9a9bc820acdd",
          "socketId": "uYoCNhoB10vgXSq1AAAD"
        },
        "room": "live_MFKD8P"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:05.166] [32mINFO [0m [SharedGameFlow] {
        "room": "live_MVN4S7",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:05.167] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:05.167] [32mINFO [0m [SharedGameFlow] {
        "room": "live_MVN4S7",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:05.167] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "MVN4S7",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament.test.ts:178:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament.test.ts:181:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament.test.ts:189:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament.test.ts:193:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament.test.ts:204:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament.test.ts:216:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      226 |             }
      227 |         } catch (e: any) {
    > 228 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      229 |         }
      230 |
      231 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament.test.ts:228:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament.test.ts:232:17)

FAIL tests/integration/gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-22 13:27:07.783] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.884] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "5ad49284-478f-466d-b441-2ffc4819cc50",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.893] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "zKR5Ig4QrOHv7ReKAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.895] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "zKR5Ig4QrOHv7ReKAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.905] [32mINFO [0m [GameHandlers] {
        "socketId": "zKR5Ig4QrOHv7ReKAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.905] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "zKR5Ig4QrOHv7ReKAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.912] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "5ad49284-478f-466d-b441-2ffc4819cc50",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'live_TST789',
        socketId: 'zKR5Ig4QrOHv7ReKAAAB',
        joinedRoomSocketIds: [ 'zKR5Ig4QrOHv7ReKAAAB' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-22 13:27:07.930] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.930] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarUrl": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.931] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.931] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarUrl": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.931] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.931] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.933] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.934] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.936] [32mINFO [0m [DisconnectHandler] {
        "socketId": "zKR5Ig4QrOHv7ReKAAAB",
        "userId": "player-123",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.937] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.938] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.939] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-123",
        "accessCode": "TST789",
        "disconnectedSocketId": "zKR5Ig4QrOHv7ReKAAAB",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.946] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "b31d27e6-a6a3-45a3-995c-96edab17d9de",
            "userId": "player-123",
            "username": "Test Player",
            "avatarUrl": "https://example.com/avatar.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:07.932Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.946] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "b31d27e6-a6a3-45a3-995c-96edab17d9de",
            "userId": "player-123",
            "username": "Test Player",
            "avatarUrl": "https://example.com/avatar.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "live_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.947] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "OpvKElEarpy14qizAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.948] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "OpvKElEarpy14qizAAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.948] [32mINFO [0m [GameHandlers] {
        "socketId": "OpvKElEarpy14qizAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.948] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OpvKElEarpy14qizAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.952] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "tOesAQnYuWOnBYZrAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.952] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "tOesAQnYuWOnBYZrAAAF",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.952] [32mINFO [0m [GameHandlers] {
        "socketId": "tOesAQnYuWOnBYZrAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.953] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "tOesAQnYuWOnBYZrAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.960] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "5ad49284-478f-466d-b441-2ffc4819cc50",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'live_TST789',
        socketId: 'OpvKElEarpy14qizAAAE',
        joinedRoomSocketIds: [ 'OpvKElEarpy14qizAAAE' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-22 13:27:07.964] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.964] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarUrl": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.964] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarUrl": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.967] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.967] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.969] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.970] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.970] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.971] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarUrl": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.971] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.971] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarUrl": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.971] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.971] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.972] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.973] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.976] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.977] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'live_TST789',
        socketId: 'tOesAQnYuWOnBYZrAAAF',
        joinedRoomSocketIds: [ 'OpvKElEarpy14qizAAAE', 'tOesAQnYuWOnBYZrAAAF' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-22 13:27:07.985] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "b2a17665-c185-4b2a-8ad6-4c34788ff851",
            "userId": "player-1",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:07.976Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.986] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "b2a17665-c185-4b2a-8ad6-4c34788ff851",
            "userId": "player-1",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "live_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.998] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "9c749660-cdcc-4654-9e1f-9ef16dca7244",
            "userId": "player-2",
            "username": "Player 2",
            "avatarUrl": "https://example.com/avatar2.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:07.992Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:07.998] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "9c749660-cdcc-4654-9e1f-9ef16dca7244",
            "userId": "player-2",
            "username": "Player 2",
            "avatarUrl": "https://example.com/avatar2.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "live_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-1': '{"userId":"player-1","username":"Player 1","avatarUrl":"https://example.com/avatar1.jpg","joinedAt":"2025-05-22T11:27:07.976Z","score":0,"online":true,"lastSocketId":"OpvKElEarpy14qizAAAE"}',
        'player-2': '{"userId":"player-2","username":"Player 2","avatarUrl":"https://example.com/avatar2.jpg","joinedAt":"2025-05-22T11:27:07.992Z","score":0,"online":true,"lastSocketId":"tOesAQnYuWOnBYZrAAAF"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:503:17)

    console.log
      [2025-05-22 13:27:08.079] [32mINFO [0m [DisconnectHandler] {
        "socketId": "OpvKElEarpy14qizAAAE",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.079] [32mINFO [0m [DisconnectHandler] {
        "socketId": "tOesAQnYuWOnBYZrAAAF",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.080] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "OpvKElEarpy14qizAAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.080] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "tOesAQnYuWOnBYZrAAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.087] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "alv_BdowaI7AVbXUAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.087] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "alv_BdowaI7AVbXUAAAI",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.087] [32mINFO [0m [GameHandlers] {
        "socketId": "alv_BdowaI7AVbXUAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.087] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "alv_BdowaI7AVbXUAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.088] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "xl0L106W0am1cTuoAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.088] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "xl0L106W0am1cTuoAAAJ",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.089] [32mINFO [0m [GameHandlers] {
        "socketId": "xl0L106W0am1cTuoAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.089] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "xl0L106W0am1cTuoAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.096] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "5ad49284-478f-466d-b441-2ffc4819cc50",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'live_TST789',
        socketId: 'alv_BdowaI7AVbXUAAAI',
        joinedRoomSocketIds: [ 'alv_BdowaI7AVbXUAAAI' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [joinGame] Player joined room: {
        roomName: 'live_TST789',
        socketId: 'xl0L106W0am1cTuoAAAJ',
        joinedRoomSocketIds: [ 'alv_BdowaI7AVbXUAAAI', 'xl0L106W0am1cTuoAAAJ' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-22 13:27:08.100] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarUrl": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarUrl": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarUrl": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.101] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarUrl": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.102] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.102] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.102] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.104] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.105] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.105] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "live_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "5ad49284-478f-466d-b441-2ffc4819cc50",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.108] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.110] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.110] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.110] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.113] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "9c749660-cdcc-4654-9e1f-9ef16dca7244",
            "userId": "player-2",
            "username": "Player 2",
            "avatarUrl": "https://example.com/avatar2.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:08.105Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.113] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "9c749660-cdcc-4654-9e1f-9ef16dca7244",
            "userId": "player-2",
            "username": "Player 2",
            "avatarUrl": "https://example.com/avatar2.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "live_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.117] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "b2a17665-c185-4b2a-8ad6-4c34788ff851",
            "userId": "player-1",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:08.113Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.117] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "b2a17665-c185-4b2a-8ad6-4c34788ff851",
            "userId": "player-1",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "live_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-1': '{"userId":"player-1","username":"Player 1","avatarUrl":"https://example.com/avatar1.jpg","joinedAt":"2025-05-22T11:27:08.113Z","score":0,"online":true,"lastSocketId":"alv_BdowaI7AVbXUAAAI"}',
        'player-2': '{"userId":"player-2","username":"Player 2","avatarUrl":"https://example.com/avatar2.jpg","joinedAt":"2025-05-22T11:27:08.105Z","score":0,"online":true,"lastSocketId":"xl0L106W0am1cTuoAAAJ"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:599:17)

    console.log
      [2025-05-22 13:27:08.609] [32mINFO [0m [DisconnectHandler] {
        "socketId": "alv_BdowaI7AVbXUAAAI",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.610] [32mINFO [0m [DisconnectHandler] {
        "socketId": "xl0L106W0am1cTuoAAAJ",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.613] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "alv_BdowaI7AVbXUAAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:08.614] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "xl0L106W0am1cTuoAAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)



  ‚óè Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/gameHandler.test.ts:246:27

      243     }
      244 });
      245 // Clean up test players
    ‚Üí 246 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `StudentProfile_id_fkey`

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/gameHandler.test.ts:246:9)

PASS tests/integration/lobbyHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-22 13:27:09.492] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.550] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "39nuBTQpIOEqf9ZhAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.551] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "39nuBTQpIOEqf9ZhAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.557] [32mINFO [0m [GameHandlers] {
        "socketId": "39nuBTQpIOEqf9ZhAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.558] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "39nuBTQpIOEqf9ZhAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.559] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-123",
        "username": "Test Player",
        "socketId": "39nuBTQpIOEqf9ZhAAAB"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.563] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "39nuBTQpIOEqf9ZhAAAB"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.569] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "39nuBTQpIOEqf9ZhAAAB"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.569] [32mINFO [0m [DisconnectHandler] {
        "socketId": "39nuBTQpIOEqf9ZhAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.569] [33mWARN [0m [DisconnectHandler] {
        "socketId": "39nuBTQpIOEqf9ZhAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.574] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "XG7xtkyirRfDLclLAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.575] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "XG7xtkyirRfDLclLAAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.575] [32mINFO [0m [GameHandlers] {
        "socketId": "XG7xtkyirRfDLclLAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.575] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "XG7xtkyirRfDLclLAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.577] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "TEWLvTWZZ0pooGQrAAAG"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.577] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "TEWLvTWZZ0pooGQrAAAG",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.577] [32mINFO [0m [GameHandlers] {
        "socketId": "TEWLvTWZZ0pooGQrAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.577] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "TEWLvTWZZ0pooGQrAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.578] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "v2S73YDqq7l1prUHAAAH"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.578] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "v2S73YDqq7l1prUHAAAH",
        "user": {
          "id": "player-3",
          "userId": "player-3",
          "username": "Player 3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.578] [32mINFO [0m [GameHandlers] {
        "socketId": "v2S73YDqq7l1prUHAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.579] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "v2S73YDqq7l1prUHAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.579] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-1",
        "username": "Player 1",
        "socketId": "XG7xtkyirRfDLclLAAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.582] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-2",
        "username": "Player 2",
        "socketId": "TEWLvTWZZ0pooGQrAAAG"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.584] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-3",
        "username": "Player 3",
        "socketId": "v2S73YDqq7l1prUHAAAH"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.595] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "XG7xtkyirRfDLclLAAAE"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.599] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "v2S73YDqq7l1prUHAAAH"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.599] [32mINFO [0m [DisconnectHandler] {
        "socketId": "v2S73YDqq7l1prUHAAAH",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.599] [33mWARN [0m [DisconnectHandler] {
        "socketId": "v2S73YDqq7l1prUHAAAH",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.600] [32mINFO [0m [DisconnectHandler] {
        "socketId": "XG7xtkyirRfDLclLAAAE",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.600] [33mWARN [0m [DisconnectHandler] {
        "socketId": "XG7xtkyirRfDLclLAAAE",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.600] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "TEWLvTWZZ0pooGQrAAAG"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.600] [32mINFO [0m [DisconnectHandler] {
        "socketId": "TEWLvTWZZ0pooGQrAAAG",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.600] [33mWARN [0m [DisconnectHandler] {
        "socketId": "TEWLvTWZZ0pooGQrAAAG",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.604] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.604] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ",
        "user": {
          "id": "player-redirect-test",
          "userId": "player-redirect-test",
          "username": "Redirect Test",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.604] [32mINFO [0m [GameHandlers] {
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.604] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:09.605] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-redirect-test",
        "username": "Redirect Test",
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.615] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "gameId": "7410e60b-6900-46cd-8f98-b73965df3441",
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ"
      } Game is now active, sending redirect

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.622] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.622] [32mINFO [0m [DisconnectHandler] {
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.622] [33mWARN [0m [DisconnectHandler] {
        "socketId": "fpi9wzb4Ws3_UjJsAAAJ",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.633] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "FT11qvdGyINRDABMAAAM"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.633] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "FT11qvdGyINRDABMAAAM",
        "user": {
          "id": "player-d1",
          "userId": "player-d1",
          "username": "Disconnect Test 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.633] [32mINFO [0m [GameHandlers] {
        "socketId": "FT11qvdGyINRDABMAAAM"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.633] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FT11qvdGyINRDABMAAAM"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.634] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "CcR2wT7IR8m0MWrzAAAN"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.635] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "CcR2wT7IR8m0MWrzAAAN",
        "user": {
          "id": "player-d2",
          "userId": "player-d2",
          "username": "Disconnect Test 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.635] [32mINFO [0m [GameHandlers] {
        "socketId": "CcR2wT7IR8m0MWrzAAAN"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.635] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "CcR2wT7IR8m0MWrzAAAN"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.635] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d1",
        "username": "Disconnect Test 1",
        "socketId": "FT11qvdGyINRDABMAAAM"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.636] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d2",
        "username": "Disconnect Test 2",
        "socketId": "CcR2wT7IR8m0MWrzAAAN"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.647] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "FT11qvdGyINRDABMAAAM"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.647] [32mINFO [0m [DisconnectHandler] {
        "socketId": "FT11qvdGyINRDABMAAAM",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.648] [33mWARN [0m [DisconnectHandler] {
        "socketId": "FT11qvdGyINRDABMAAAM",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.955] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "CcR2wT7IR8m0MWrzAAAN"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.956] [32mINFO [0m [DisconnectHandler] {
        "socketId": "CcR2wT7IR8m0MWrzAAAN",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:11.957] [33mWARN [0m [DisconnectHandler] {
        "socketId": "CcR2wT7IR8m0MWrzAAAN",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/teacherQuiz.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-22 13:27:12.515] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.518] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      Creating game template with payload: {
        name: 'My First Quiz Template',
        discipline: 'math',
        gradeLevel: 'middle',
        themes: [ 'arithmetic' ],
        questions: [ { questionUid: 'test-q-quiz-1', sequence: 1 } ]
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:94:17)

    console.log
      [2025-05-22 13:27:12.629] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ZDE0MTE3ZS0wMmQyLTQ1Y2MtODJkNy04YTE2MTkzMTFlMzkiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDc5MTMyMzIsImV4cCI6MTc0NzkxNjgzMn0.TD8bwWxDEaUoMjK1NLaaZmpfzkYh-BrV05GJ1STEPz0"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.631] [32mINFO [0m [GameTemplatesAPI] {
        "body": {
          "name": "My First Quiz Template",
          "discipline": "math",
          "gradeLevel": "middle",
          "themes": [
            "arithmetic"
          ],
          "questions": [
            {
              "questionUid": "test-q-quiz-1",
              "sequence": 1
            }
          ]
        },
        "user": {
          "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
          "username": "quizTeacher",
          "role": "TEACHER",
          "iat": 1747913232,
          "exp": 1747916832
        }
      } Received request for game template creation

      at log (src/utils/logger.ts:102:21)

    console.log
      Game template response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:111:17)

    console.log
      Game template response body: {
        gameTemplate: {
          id: '4da19d5a-e08a-4079-8f94-a0606f2fc3c7',
          name: 'My First Quiz Template',
          creatorId: '6d14117e-02d2-45cc-82d7-8a1619311e39',
          gradeLevel: 'middle',
          themes: [ 'arithmetic' ],
          discipline: 'math',
          description: null,
          defaultMode: null,
          createdAt: '2025-05-22T11:27:12.634Z',
          updatedAt: '2025-05-22T11:27:12.634Z',
          questions: [ [Object] ]
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:112:17)

    console.log
      Creating game instance with payload: {
        name: 'Live Quiz Session 1',
        playMode: 'quiz',
        gameTemplateId: '4da19d5a-e08a-4079-8f94-a0606f2fc3c7'
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:118:17)

    console.log
      [2025-05-22 13:27:12.654] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "accessCode": "NRRFQR"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Game instance response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:131:17)

    console.log
      Game instance response body: {
        gameInstance: {
          id: '154afe5e-edd1-410f-8f4d-ad84f83ef121',
          name: 'Live Quiz Session 1',
          gameTemplateId: '4da19d5a-e08a-4079-8f94-a0606f2fc3c7',
          initiatorUserId: '6d14117e-02d2-45cc-82d7-8a1619311e39',
          accessCode: 'NRRFQR',
          status: 'pending',
          playMode: 'quiz',
          leaderboard: null,
          currentQuestionIndex: null,
          settings: {},
          createdAt: '2025-05-22T11:27:12.647Z',
          startedAt: null,
          endedAt: null,
          isDiffered: false,
          differedAvailableFrom: null,
          differedAvailableTo: null,
          gameTemplate: {
            name: 'My First Quiz Template',
            themes: [Array],
            discipline: 'math',
            gradeLevel: 'middle'
          }
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:132:17)

    console.log
      [2025-05-22 13:27:12.658] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "PgM4Og4ZSbxv1lt-AAAB",
        "user": {
          "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.663] [32mINFO [0m [GameHandlers] {
        "socketId": "PgM4Og4ZSbxv1lt-AAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.664] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "PgM4Og4ZSbxv1lt-AAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.665] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "PgM4Og4ZSbxv1lt-AAAB",
        "socketData": {
          "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
          "user": {
            "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
            "role": "TEACHER"
          },
          "connectionInfo": {
            "id": "PgM4Og4ZSbxv1lt-AAAB",
            "address": "::ffff:127.0.0.1",
            "time": "2025-05-22T11:27:12.658Z"
          }
        },
        "auth": {
          "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ZDE0MTE3ZS0wMmQyLTQ1Y2MtODJkNy04YTE2MTkzMTFlMzkiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDc5MTMyMzIsImV4cCI6MTc0NzkxNjgzMn0.TD8bwWxDEaUoMjK1NLaaZmpfzkYh-BrV05GJ1STEPz0",
          "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
          "userType": "teacher"
        },
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "jgcb560ypRpJNbAu17zgyg==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:41833"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.666] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "socketId": "PgM4Og4ZSbxv1lt-AAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.668] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "PgM4Og4ZSbxv1lt-AAAB",
        "allRooms": [
          "PgM4Og4ZSbxv1lt-AAAB",
          "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
          "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121"
        ],
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "dashboardSockets": [
          "PgM4Og4ZSbxv1lt-AAAB"
        ],
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "projectionSockets": [
          "PgM4Og4ZSbxv1lt-AAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.671] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "socketId": "PgM4Og4ZSbxv1lt-AAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-22 13:27:12.674] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "qy6C2jMWnHbg40u4AAAD",
        "user": {
          "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
          "username": "quizPlayer1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.674] [32mINFO [0m [GameHandlers] {
        "socketId": "qy6C2jMWnHbg40u4AAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.674] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "qy6C2jMWnHbg40u4AAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'live_NRRFQR',
        socketId: 'qy6C2jMWnHbg40u4AAAD',
        joinedRoomSocketIds: [ 'qy6C2jMWnHbg40u4AAAD' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-22 13:27:12.685] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.686] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "room": "live_NRRFQR",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.686] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.686] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "room": "live_NRRFQR",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.686] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "room": "live_NRRFQR",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.686] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "room": "live_NRRFQR",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.687] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "room": "live_NRRFQR",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
          "accessCode": "NRRFQR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.687] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "room": "live_NRRFQR",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
          "accessCode": "NRRFQR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.690] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "questionUid": "test-q-quiz-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.692] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.692] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "NRRFQR",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.693] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "NRRFQR",
          "participant": {
            "id": "594ce0fd-6941-45f7-8c79-90dac67f1ac3",
            "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
            "username": "quizPlayer1",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:12.684Z",
            "online": true
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.693] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "594ce0fd-6941-45f7-8c79-90dac67f1ac3",
            "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
            "username": "quizPlayer1",
            "score": 0,
            "online": true
          }
        },
        "room": "live_NRRFQR"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.695] [32mINFO [0m [GameStateService] {
        "accessCode": "NRRFQR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.696] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "live_NRRFQR",
        "liveRoomSocketIds": [
          "qy6C2jMWnHbg40u4AAAD"
        ],
        "payload": {
          "question": {
            "uid": "test-q-quiz-1",
            "text": "What is 2+2 for quiz?",
            "answerOptions": [
              "3",
              "4",
              "5"
            ],
            "correctAnswers": [
              false,
              false,
              false
            ],
            "questionType": "multiple_choice_single_answer",
            "timeLimit": 30,
            "currentQuestionIndex": 0,
            "totalQuestions": 1
          },
          "timer": {
            "startedAt": 1747913232695,
            "duration": 30000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'live_NRRFQR',
        liveRoomSocketIds: [ 'qy6C2jMWnHbg40u4AAAD' ],
        payload: {
          question: {
            uid: 'test-q-quiz-1',
            title: undefined,
            text: 'What is 2+2 for quiz?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'multiple_choice_single_answer',
            timeLimit: 30,
            currentQuestionIndex: 0,
            totalQuestions: 1
          },
          timer: { startedAt: 1747913232695, duration: 30000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:192:25)

    console.log
      [2025-05-22 13:27:12.696] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "questionUid": "test-q-quiz-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.698] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.699] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.699] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.701] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.701] [32mINFO [0m [GameStateService] {
        "accessCode": "NRRFQR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.701] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "liveRoom": "live_NRRFQR",
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.701] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.701] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "liveRoom": "live_NRRFQR",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.702] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.702] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.705] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
          "action": "pause"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.705] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "action": "pause"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.706] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "action": "pause"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.708] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "pause",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1747913232708,
          "timeRemaining": 29993
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.708] [32mINFO [0m [GameStateService] {
        "accessCode": "NRRFQR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.708] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "pause",
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "liveRoom": "live_NRRFQR",
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1747913232708,
          "timeRemaining": 29993
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.708] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "pause",
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1747913232708,
          "timeRemaining": 29993
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.709] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "pause",
        "liveRoom": "live_NRRFQR",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1747913232708,
          "timeRemaining": 29993
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.709] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "pause",
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913232701,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1747913232708,
          "timeRemaining": 29993
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:12.709] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "pause"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.710] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.710] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.711] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.714] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "timer": {
          "startedAt": 1747913233714,
          "duration": 29993,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.715] [32mINFO [0m [GameStateService] {
        "accessCode": "NRRFQR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.715] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "liveRoom": "live_NRRFQR",
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913233714,
          "duration": 29993,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.715] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913233714,
          "duration": 29993,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.716] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "liveRoom": "live_NRRFQR",
        "timer": {
          "startedAt": 1747913233714,
          "duration": 29993,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.716] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume",
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 1747913233714,
          "duration": 29993,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.716] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.717] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
          "action": "stop"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.717] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "action": "stop"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.717] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "action": "stop"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.719] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "stop",
        "timer": {
          "startedAt": 0,
          "duration": 29993,
          "isPaused": true,
          "timeRemaining": 0
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.719] [32mINFO [0m [GameStateService] {
        "accessCode": "NRRFQR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.719] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "stop",
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "liveRoom": "live_NRRFQR",
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 0,
          "duration": 29993,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.719] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "stop",
        "dashboardRoom": "dashboard_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 0,
          "duration": 29993,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.720] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "stop",
        "liveRoom": "live_NRRFQR",
        "timer": {
          "startedAt": 0,
          "duration": 29993,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.720] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "stop",
        "projectionRoom": "projection_154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "timer": {
          "startedAt": 0,
          "duration": 29993,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.720] [32mINFO [0m [TimerActionHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "action": "stop"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.721] [32mINFO [0m [DisconnectHandler] {
        "socketId": "PgM4Og4ZSbxv1lt-AAAB",
        "userId": "6d14117e-02d2-45cc-82d7-8a1619311e39",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.721] [33mWARN [0m [DisconnectHandler] {
        "socketId": "PgM4Og4ZSbxv1lt-AAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.722] [32mINFO [0m [DisconnectHandler] {
        "socketId": "qy6C2jMWnHbg40u4AAAD",
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "accessCode": "NRRFQR",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.723] [32mINFO [0m [DisconnectHandler] {
        "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
        "accessCode": "NRRFQR",
        "socketId": "qy6C2jMWnHbg40u4AAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.724] [32mINFO [0m [DisconnectHandler] {
        "gameId": "154afe5e-edd1-410f-8f4d-ad84f83ef121",
        "socketId": "PgM4Og4ZSbxv1lt-AAAB"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:13.725] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "60500dc5-5b3c-40bc-869f-535fca9df792",
          "socketId": "qy6C2jMWnHbg40u4AAAD"
        },
        "room": "live_NRRFQR"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/mockedGameHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-22 13:27:14.233] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.372] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "982dabec-061e-4b05-8384-8d1641338270",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.381] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-e0r0785xgh"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.381] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-e0r0785xgh"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'live_TST789',
        socketId: 'socket-e0r0785xgh',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-22 13:27:14.391] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "78193256-1a51-4b6e-a842-9ba8541bd710",
            "userId": "player-1_mazaer7az3qwwo",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:14.387Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.391] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "78193256-1a51-4b6e-a842-9ba8541bd710",
            "userId": "player-1_mazaer7az3qwwo",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "live_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.509] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-v2t3wlyjq6l"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.509] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-v2t3wlyjq6l"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.517] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-301pgvoq2ud"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.518] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-301pgvoq2ud"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-7',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-301pgvoq2ud Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:14.521] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-301pgvoq2ud",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-7",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.522] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-301pgvoq2ud",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-7',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-301pgvoq2ud Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:14.522] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-301pgvoq2ud",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-7",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.522] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-301pgvoq2ud",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.528] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-mr3psd9asco"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.529] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-mr3psd9asco"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.667] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-40cu53blfxc"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.667] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-40cu53blfxc"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.720] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-n0ea457lqp"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.720] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-n0ea457lqp"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.746] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "553e8c57-a1dd-4bc6-9e06-278d4b11e660",
            "userId": "player-1_mazaer7az3qwwo",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:14.738Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-05-22T11:27:14.701Z",
          "differedAvailableTo": "2025-05-22T12:27:14.701Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.767] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-8o8n41cbnr3"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.767] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-8o8n41cbnr3"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.769] [33mWARN [0m [JoinGameHandler] {
        "errorPayload": {
          "message": "Differed mode not available at this time."
        }
      } Emitting game_error: differed window not available

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.792] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-tcqiq1mqw7h"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.793] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-tcqiq1mqw7h"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.796] [32mINFO [0m [JoinGameHandler] {
        "gameAlreadyPlayedPayload": {
          "accessCode": "DIFF123"
        }
      } Emitting game_already_played

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.810] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-4f3njw7nhfr"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.810] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-4f3njw7nhfr"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.825] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "bd3faf25-ed79-48b2-b557-569f493396b0",
            "userId": "player-3_mazaer7az3qwwo",
            "username": "Player 3",
            "avatarUrl": "https://example.com/avatar3.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:14.821Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-05-22T11:27:14.770Z",
          "differedAvailableTo": "2025-05-22T12:27:14.770Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mazaer7az3qwwo',
        questionId: '23cbabc4-f534-4aea-ab7a-03ed94b9a703',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-4f3njw7nhfr Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:14.826] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-4f3njw7nhfr",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mazaer7az3qwwo",
          "questionId": "23cbabc4-f534-4aea-ab7a-03ed94b9a703",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.844] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mazaer7az3qwwo",
        "questionId": "23cbabc4-f534-4aea-ab7a-03ed94b9a703"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId 23cbabc4-f534-4aea-ab7a-03ed94b9a703 to answered questions

      at log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '23cbabc4-f534-4aea-ab7a-03ed94b9a703' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:216:29)

    console.log
      [2025-05-22 13:27:14.845] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mazaer7az3qwwo",
        "questionId": "23cbabc4-f534-4aea-ab7a-03ed94b9a703"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mazaer7az3qwwo',
        questionId: '23cbabc4-f534-4aea-ab7a-03ed94b9a703',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-4f3njw7nhfr Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:14.845] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-4f3njw7nhfr",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mazaer7az3qwwo",
          "questionId": "23cbabc4-f534-4aea-ab7a-03ed94b9a703",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.865] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mazaer7az3qwwo",
        "questionId": "23cbabc4-f534-4aea-ab7a-03ed94b9a703"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":"b","timestamp":"2025-05-22T11:27:14.831Z","questionUid":"23cbabc4-f534-4aea-ab7a-03ed94b9a703","timeTakenMs":2000}]

      at log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '23cbabc4-f534-4aea-ab7a-03ed94b9a703' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:216:29)

    console.log
      [2025-05-22 13:27:14.866] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mazaer7az3qwwo",
        "questionId": "23cbabc4-f534-4aea-ab7a-03ed94b9a703"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.879] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-qb33vgymwz8"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.879] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-qb33vgymwz8"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'live_TST789',
        socketId: 'socket-qb33vgymwz8',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-22 13:27:14.885] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "78193256-1a51-4b6e-a842-9ba8541bd710",
            "userId": "player-1_mazaer7az3qwwo",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:14.882Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.885] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "78193256-1a51-4b6e-a842-9ba8541bd710",
            "userId": "player-1_mazaer7az3qwwo",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "live_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.889] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.892] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionIndex": 0
      } Current question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mazaer7az3qwwo',
        questionId: '4b453f30-7dbf-40a3-a02d-887cf9221c52',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-qb33vgymwz8 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:14.893] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-qb33vgymwz8",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mazaer7az3qwwo",
          "questionId": "4b453f30-7dbf-40a3-a02d-887cf9221c52",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.901] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mazaer7az3qwwo",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_10f19a72-3c7a-41ce-96a3-2896e51457b3_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.901] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "4b453f30-7dbf-40a3-a02d-887cf9221c52",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question 4b453f30-7dbf-40a3-a02d-887cf9221c52 to socket socket-qb33vgymwz8

      at log (src/sockets/handlers/game/gameAnswer.ts:242:29)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mazaer7az3qwwo',
        questionId: '4b453f30-7dbf-40a3-a02d-887cf9221c52',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-qb33vgymwz8 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:14.902] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-qb33vgymwz8",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mazaer7az3qwwo",
          "questionId": "4b453f30-7dbf-40a3-a02d-887cf9221c52",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.912] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mazaer7az3qwwo",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_10f19a72-3c7a-41ce-96a3-2896e51457b3_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:14.913] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "4b453f30-7dbf-40a3-a02d-887cf9221c52",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question 4b453f30-7dbf-40a3-a02d-887cf9221c52 to socket socket-qb33vgymwz8

      at log (src/sockets/handlers/game/gameAnswer.ts:242:29)

    console.log
      [DEBUG before scoring] Redis key: mathquest:game:answers:TST789:4b453f30-7dbf-40a3-a02d-887cf9221c52 value: {
        'player-1_mazaer7az3qwwo': '{"userId":"player-1_mazaer7az3qwwo","answer":1,"timeSpent":5000,"submittedAt":1747913234911}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:920:21)

    console.log
      [2025-05-22 13:27:14.917] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionId": "4b453f30-7dbf-40a3-a02d-887cf9221c52"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG after scoring] Redis key: mathquest:game:answers:TST789:4b453f30-7dbf-40a3-a02d-887cf9221c52 value: {
        'player-1_mazaer7az3qwwo': '{"userId":"player-1_mazaer7az3qwwo","answer":1,"timeSpent":5000,"submittedAt":1747913234911}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:927:21)

PASS tests/integration/socketConnection.test.ts
  ‚óè Console

    console.log
      Connecting to server...

      at Object.<anonymous> (tests/integration/socketConnection.test.ts:80:17)

    console.log
      [2025-05-22 13:27:15.135] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.139] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "VVBV5jmrOWzpcB9CAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.139] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "VVBV5jmrOWzpcB9CAAAB",
        "user": {
          "id": "test-player-123",
          "userId": "test-player-123",
          "username": "test-player-123",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.146] [32mINFO [0m [GameHandlers] {
        "socketId": "VVBV5jmrOWzpcB9CAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.146] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "VVBV5jmrOWzpcB9CAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket connected successfully

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:60:21)

    console.log
      Received connection_established event: {
        socketId: 'VVBV5jmrOWzpcB9CAAAB',
        timestamp: '2025-05-22T11:27:15.140Z',
        user: {
          role: 'STUDENT',
          userId: 'test-player-123',
          username: 'test-player-123'
        }
      }

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:71:21)

    console.log
      Authentication test connecting to server...

      at Object.<anonymous> (tests/integration/socketConnection.test.ts:122:17)

    console.log
      [2025-05-22 13:27:15.152] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "I5dvGo6_CcHRgACqAAAD"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.152] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "I5dvGo6_CcHRgACqAAAD",
        "user": {
          "id": "test-player-123",
          "userId": "test-player-123",
          "username": "test-player-123",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.152] [32mINFO [0m [GameHandlers] {
        "socketId": "I5dvGo6_CcHRgACqAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.152] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "I5dvGo6_CcHRgACqAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      Authentication test socket connected successfully

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:103:21)

    console.log
      Authentication test received connection_established event: {
        socketId: 'I5dvGo6_CcHRgACqAAAD',
        timestamp: '2025-05-22T11:27:15.152Z',
        user: {
          role: 'STUDENT',
          userId: 'test-player-123',
          username: 'test-player-123'
        }
      }

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:113:21)

    console.log
      [2025-05-22 13:27:15.154] [32mINFO [0m [DisconnectHandler] {
        "socketId": "I5dvGo6_CcHRgACqAAAD",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.154] [33mWARN [0m [DisconnectHandler] {
        "socketId": "I5dvGo6_CcHRgACqAAAD",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.154] [32mINFO [0m [DisconnectHandler] {
        "socketId": "VVBV5jmrOWzpcB9CAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:15.154] [33mWARN [0m [DisconnectHandler] {
        "socketId": "VVBV5jmrOWzpcB9CAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/teacherDashboard.test.ts
  ‚óè Console

    console.log
      [2025-05-22 13:27:16.402] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.518] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "accessCode": "TEST123"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.533] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.539] [32mINFO [0m [GameHandlers] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.539] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.543] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "WynJ3joZz8SyQ9nQAAAB",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-22T11:27:16.532Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.544] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "WynJ3joZz8SyQ9nQAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.545] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB",
        "allRooms": [
          "WynJ3joZz8SyQ9nQAAAB",
          "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
          "projection_9984197a-88d6-4f56-8d00-74d46bbd8569"
        ],
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "dashboardSockets": [
          "WynJ3joZz8SyQ9nQAAAB"
        ],
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "projectionSockets": [
          "WynJ3joZz8SyQ9nQAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.548] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "WynJ3joZz8SyQ9nQAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-22 13:27:16.549] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "WynJ3joZz8SyQ9nQAAAB",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-22T11:27:16.532Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.549] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "WynJ3joZz8SyQ9nQAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.551] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB",
        "allRooms": [
          "WynJ3joZz8SyQ9nQAAAB",
          "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
          "projection_9984197a-88d6-4f56-8d00-74d46bbd8569"
        ],
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "dashboardSockets": [
          "WynJ3joZz8SyQ9nQAAAB"
        ],
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "projectionSockets": [
          "WynJ3joZz8SyQ9nQAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.555] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "WynJ3joZz8SyQ9nQAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-22 13:27:16.559] [32mINFO [0m [DisconnectHandler] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.559] [33mWARN [0m [DisconnectHandler] {
        "socketId": "WynJ3joZz8SyQ9nQAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.561] [32mINFO [0m [DisconnectHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "socketId": "WynJ3joZz8SyQ9nQAAAB"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.563] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "j3UuxJtYYrg-o5WoAAAD",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.564] [32mINFO [0m [GameHandlers] {
        "socketId": "j3UuxJtYYrg-o5WoAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.564] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "j3UuxJtYYrg-o5WoAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.566] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "j3UuxJtYYrg-o5WoAAAD",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "j3UuxJtYYrg-o5WoAAAD",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-22T11:27:16.563Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.566] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "j3UuxJtYYrg-o5WoAAAD"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.568] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "j3UuxJtYYrg-o5WoAAAD",
        "allRooms": [
          "j3UuxJtYYrg-o5WoAAAD",
          "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
          "projection_9984197a-88d6-4f56-8d00-74d46bbd8569"
        ],
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "dashboardSockets": [
          "j3UuxJtYYrg-o5WoAAAD"
        ],
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "projectionSockets": [
          "j3UuxJtYYrg-o5WoAAAD"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.571] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "j3UuxJtYYrg-o5WoAAAD"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-22 13:27:16.572] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "questionUid": "q-late-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.576] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.576] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "live_TEST123",
        "liveRoomSocketIds": [],
        "payload": {
          "question": {
            "uid": "q-late-1",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              false
            ],
            "questionType": "single_correct",
            "timeLimit": 2,
            "currentQuestionIndex": 0,
            "totalQuestions": 14
          },
          "timer": {
            "startedAt": 1747913236576,
            "duration": 2000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'live_TEST123',
        liveRoomSocketIds: [],
        payload: {
          question: {
            uid: 'q-late-1',
            title: undefined,
            text: 'What is 10 + 5?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'single_correct',
            timeLimit: 2,
            currentQuestionIndex: 0,
            totalQuestions: 14
          },
          timer: { startedAt: 1747913236576, duration: 2000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:192:25)

    console.log
      [2025-05-22 13:27:16.576] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "questionUid": "q-late-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.578] [32mINFO [0m [DisconnectHandler] {
        "socketId": "j3UuxJtYYrg-o5WoAAAD",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.578] [33mWARN [0m [DisconnectHandler] {
        "socketId": "j3UuxJtYYrg-o5WoAAAD",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.581] [32mINFO [0m [DisconnectHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "socketId": "j3UuxJtYYrg-o5WoAAAD"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.582] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "6Z00iXsPzZ__FtqbAAAF",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.582] [32mINFO [0m [GameHandlers] {
        "socketId": "6Z00iXsPzZ__FtqbAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.582] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "6Z00iXsPzZ__FtqbAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.584] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "6Z00iXsPzZ__FtqbAAAF",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "6Z00iXsPzZ__FtqbAAAF",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-22T11:27:16.582Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.584] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "6Z00iXsPzZ__FtqbAAAF"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.586] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "6Z00iXsPzZ__FtqbAAAF",
        "allRooms": [
          "6Z00iXsPzZ__FtqbAAAF",
          "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
          "projection_9984197a-88d6-4f56-8d00-74d46bbd8569"
        ],
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "dashboardSockets": [
          "6Z00iXsPzZ__FtqbAAAF"
        ],
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "projectionSockets": [
          "6Z00iXsPzZ__FtqbAAAF"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.590] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "6Z00iXsPzZ__FtqbAAAF"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-22 13:27:16.591] [32mINFO [0m [Test] [TEST] About to emit quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.591] [32mINFO [0m [Test] [TEST] quiz_timer_action event emitted

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.591] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
          "action": "start",
          "duration": 30
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.592] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "action": "start",
        "duration": 30
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.592] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "action": "start",
        "duration": 30
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.593] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "action": "start",
        "now": 1747913236593,
        "validDuration": 30,
        "timer": {
          "startedAt": 1747913236576,
          "duration": 2000,
          "isPaused": true
        }
      } [TIMER_ACTION] Processing start action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.593] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "action": "start",
        "timer": {
          "startedAt": 1747913236593,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Timer object after start processing

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.593] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "action": "start",
        "timer": {
          "startedAt": 1747913236593,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.594] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.594] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "action": "start",
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "liveRoom": "live_TEST123",
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "timer": {
          "startedAt": 1747913236593,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.594] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "action": "start",
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "timer": {
          "startedAt": 1747913236593,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.594] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "action": "start",
        "liveRoom": "live_TEST123",
        "timer": {
          "startedAt": 1747913236593,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.594] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "action": "start",
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "timer": {
          "startedAt": 1747913236593,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.594] [32mINFO [0m [TimerActionHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "action": "start"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.595] [32mINFO [0m [Test] [TEST] Received dashboard_timer_updated event {
        "timer": {
          "startedAt": 1747913236593,
          "duration": 30000,
          "isPaused": false
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.596] [32mINFO [0m [DisconnectHandler] {
        "socketId": "6Z00iXsPzZ__FtqbAAAF",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.596] [33mWARN [0m [DisconnectHandler] {
        "socketId": "6Z00iXsPzZ__FtqbAAAF",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.598] [32mINFO [0m [DisconnectHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "socketId": "6Z00iXsPzZ__FtqbAAAF"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.600] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "RfuVZClhKQ8VtS2jAAAH",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.601] [32mINFO [0m [GameHandlers] {
        "socketId": "RfuVZClhKQ8VtS2jAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.601] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "RfuVZClhKQ8VtS2jAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.606] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "RfuVZClhKQ8VtS2jAAAH",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "RfuVZClhKQ8VtS2jAAAH",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-22T11:27:16.600Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.607] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "RfuVZClhKQ8VtS2jAAAH"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.609] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "RfuVZClhKQ8VtS2jAAAH",
        "allRooms": [
          "RfuVZClhKQ8VtS2jAAAH",
          "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
          "projection_9984197a-88d6-4f56-8d00-74d46bbd8569"
        ],
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "dashboardSockets": [
          "RfuVZClhKQ8VtS2jAAAH"
        ],
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "projectionSockets": [
          "RfuVZClhKQ8VtS2jAAAH"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.616] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "RfuVZClhKQ8VtS2jAAAH"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-22 13:27:16.618] [32mINFO [0m [LockAnswersHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "lock": true
      } Answer lock requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.621] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.621] [32mINFO [0m [LockAnswersHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "lock": true
      } Answers lock status updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.623] [32mINFO [0m [DisconnectHandler] {
        "socketId": "RfuVZClhKQ8VtS2jAAAH",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.623] [33mWARN [0m [DisconnectHandler] {
        "socketId": "RfuVZClhKQ8VtS2jAAAH",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.626] [32mINFO [0m [DisconnectHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "socketId": "RfuVZClhKQ8VtS2jAAAH"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.628] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.628] [32mINFO [0m [GameHandlers] {
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.628] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.632] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "RXJ1RBYQGCBpU-tgAAAJ",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-22T11:27:16.628Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.632] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.634] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ",
        "allRooms": [
          "RXJ1RBYQGCBpU-tgAAAJ",
          "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
          "projection_9984197a-88d6-4f56-8d00-74d46bbd8569"
        ],
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "dashboardSockets": [
          "RXJ1RBYQGCBpU-tgAAAJ"
        ],
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "projectionSockets": [
          "RXJ1RBYQGCBpU-tgAAAJ"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.639] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-22 13:27:16.641] [32mINFO [0m [EndGameHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1"
      } Game end requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.645] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.649] [32mINFO [0m [EndGameHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569"
      } Game ended successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.650] [32mINFO [0m [DisconnectHandler] {
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.650] [33mWARN [0m [DisconnectHandler] {
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.652] [32mINFO [0m [DisconnectHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "socketId": "RXJ1RBYQGCBpU-tgAAAJ"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.655] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "QRnE-WGyc-9H-I_GAAAL",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.656] [32mINFO [0m [GameHandlers] {
        "socketId": "QRnE-WGyc-9H-I_GAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.657] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "QRnE-WGyc-9H-I_GAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.659] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "QRnE-WGyc-9H-I_GAAAL",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "QRnE-WGyc-9H-I_GAAAL",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-22T11:27:16.655Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.659] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "QRnE-WGyc-9H-I_GAAAL"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.661] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "QRnE-WGyc-9H-I_GAAAL",
        "allRooms": [
          "QRnE-WGyc-9H-I_GAAAL",
          "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
          "projection_9984197a-88d6-4f56-8d00-74d46bbd8569"
        ],
        "dashboardRoom": "dashboard_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "dashboardSockets": [
          "QRnE-WGyc-9H-I_GAAAL"
        ],
        "projectionRoom": "projection_9984197a-88d6-4f56-8d00-74d46bbd8569",
        "projectionSockets": [
          "QRnE-WGyc-9H-I_GAAAL"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:16.667] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "userId": "teacher-1",
        "socketId": "QRnE-WGyc-9H-I_GAAAL"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-22 13:27:16.669] [32mINFO [0m [DisconnectHandler] {
        "socketId": "QRnE-WGyc-9H-I_GAAAL",
        "userId": "teacher-1",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:27:16.669] [33mWARN [0m [DisconnectHandler] {
        "socketId": "QRnE-WGyc-9H-I_GAAAL",
        "reason": "server shutting down"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-22 13:27:16.671] [32mINFO [0m [DisconnectHandler] {
        "gameId": "9984197a-88d6-4f56-8d00-74d46bbd8569",
        "socketId": "QRnE-WGyc-9H-I_GAAAL"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/updated-gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-22 13:27:17.186] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/practiceMode.test.ts
  ‚óè Console

    console.log
      [2025-05-22 13:27:17.713] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.786] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "59ae4b86-5802-4fbd-9d81-e05537e36a8e",
        "accessCode": "PRACTICE1"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket query params: {
        token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJwcmFjdGljZS1wbGF5ZXItMSIsInVzZXJuYW1lIjoiUHJhY3RpY2UgUGxheWVyIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDc5MTMyMzcsImV4cCI6MTc0NzkxNjgzN30.r9Ur28XN7ITcrKSV779ILQYtiGFkw8fv-9eqsmrYwKk',
        role: 'STUDENT'
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:134:17)

    console.log
      [2025-05-22 13:27:17.790] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "user": {
          "id": "practice-player-1",
          "userId": "practice-player-1",
          "username": "Practice Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.796] [32mINFO [0m [GameHandlers] {
        "socketId": "dLrqSHD1L4bCRtspAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.796] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "dLrqSHD1L4bCRtspAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] connection_established [
        {
          socketId: 'dLrqSHD1L4bCRtspAAAB',
          timestamp: '2025-05-22T11:27:17.790Z',
          user: {
            role: 'STUDENT',
            userId: 'practice-player-1',
            username: 'Practice Player'
          }
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Socket connected and ready to emit events, ID: dLrqSHD1L4bCRtspAAAB

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:162:17)

    console.log
      Waiting for event: game_joined with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-22 13:27:17.808] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.808] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "live_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.808] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.808] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "live_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.808] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "live_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.808] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "live_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.810] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "live_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "59ae4b86-5802-4fbd-9d81-e05537e36a8e",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.810] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "live_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "59ae4b86-5802-4fbd-9d81-e05537e36a8e",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: '59ae4b86-5802-4fbd-9d81-e05537e36a8e',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: game_joined {
        gameId: '59ae4b86-5802-4fbd-9d81-e05537e36a8e',
        accessCode: 'PRACTICE1',
        status: 'pending',
        currentQuestionIndex: -1,
        totalQuestions: 2,
        timer: { startedAt: 0, duration: 0, isPaused: true },
        question: null
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: '59ae4b86-5802-4fbd-9d81-e05537e36a8e',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Successfully received game_joined event, now starting game...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:171:17)

    console.log
      Emitted start_game again to ensure it gets processed

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:187:17)

    console.log
      [2025-05-22 13:27:17.813] [32mINFO [0m [GameHandlers] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.813] [32mINFO [0m [GameHandlers] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.813] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.814] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.814] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "PRACTICE1",
          "participant": {
            "id": "e7c90a39-79a9-427b-92e9-f5346c841816",
            "userId": "practice-player-1",
            "username": "Practice Player",
            "score": 0,
            "joinedAt": "2025-05-22T11:27:17.808Z",
            "online": true
          },
          "gameStatus": "waiting",
          "isDiffered": true
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          accessCode: 'PRACTICE1',
          participant: {
            id: 'e7c90a39-79a9-427b-92e9-f5346c841816',
            userId: 'practice-player-1',
            username: 'Practice Player',
            score: 0,
            joinedAt: '2025-05-22T11:27:17.808Z',
            online: true
          },
          gameStatus: 'waiting',
          isDiffered: true
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [2025-05-22 13:27:17.817] [32mINFO [0m [GameHandlers] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "questionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Direct handler for game_question event received: {
        uid: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:180:25)

    console.log
      Promise resolved with game_question data

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:191:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-22 13:27:17.819] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "dLrqSHD1L4bCRtspAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
        answer: 1,
        timeSpent: 1000
      } Socket ID: dLrqSHD1L4bCRtspAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:17.819] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
        answer: 1,
        timeSpent: 1000
      } Socket ID: dLrqSHD1L4bCRtspAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:17.819] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.820] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "dLrqSHD1L4bCRtspAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.820] [32mINFO [0m [GameHandlers] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "questionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      [2025-05-22 13:27:17.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
        timeSpent: 1000,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Waiting for event: game_question with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-22 13:27:17.837] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.840] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId 3b862de0-7cae-4a87-b9ba-3e8719b10cc1 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ '3b862de0-7cae-4a87-b9ba-3e8719b10cc1' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:223:29)

    console.log
      [2025-05-22 13:27:17.844] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "nextQuestionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431"
      } Sending next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [REQUEST_NEXT_QUESTION] About to send question: {
        uid: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
        text: 'What is 2+2?',
        index: 1
      }

      at Socket.log (src/sockets/handlers/game/requestNextQuestion.ts:83:25)

    console.log
      [2025-05-22 13:27:17.848] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "3b862de0-7cae-4a87-b9ba-3e8719b10cc1"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId 3b862de0-7cae-4a87-b9ba-3e8719b10cc1 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ '3b862de0-7cae-4a87-b9ba-3e8719b10cc1' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:223:29)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
          text: 'What is 2+2?',
          answerOptions: [ '3', '4', '5' ],
          correctAnswers: [ false, true, false ],
          questionType: 'multiple_choice_single_answer',
          timeLimit: 20,
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q2',
          currentQuestionIndex: 1,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
        text: 'What is 2+2?',
        answerOptions: [ '3', '4', '5' ],
        correctAnswers: [ false, true, false ],
        questionType: 'multiple_choice_single_answer',
        timeLimit: 20,
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q2',
        currentQuestionIndex: 1,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Event received: game_question {
        uid: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
        text: 'What is 2+2?',
        answerOptions: [ '3', '4', '5' ],
        correctAnswers: [ false, true, false ],
        questionType: 'multiple_choice_single_answer',
        timeLimit: 20,
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q2',
        currentQuestionIndex: 1,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Answering second question: {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
        answer: 1,
        timeSpent: 1200
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:207:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-22 13:27:17.850] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "dLrqSHD1L4bCRtspAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
        answer: 1,
        timeSpent: 1200
      } Socket ID: dLrqSHD1L4bCRtspAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:17.850] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
        answer: 1,
        timeSpent: 1200
      } Socket ID: dLrqSHD1L4bCRtspAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-22 13:27:17.850] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.850] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "dLrqSHD1L4bCRtspAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.853] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.853] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.853] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.853] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Received feedback for second question: {
        questionId: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:210:17)

    console.log
      Requesting to proceed after last question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:221:17)

    console.log
      Waiting for game_ended event after requesting next question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:225:17)

    console.log
      Waiting for event: game_ended with timeout 15000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-22 13:27:17.866] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: '5b7d99e2-6c26-4806-8dda-90dcd0a5d431',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [2025-05-22 13:27:17.868] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-05-22T11:27:17.824Z","questionUid":"3b862de0-7cae-4a87-b9ba-3e8719b10cc1","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId 5b7d99e2-6c26-4806-8dda-90dcd0a5d431 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
        '5b7d99e2-6c26-4806-8dda-90dcd0a5d431'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:216:29)

    console.log
      [2025-05-22 13:27:17.868] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.868] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-05-22T11:27:17.824Z","questionUid":"3b862de0-7cae-4a87-b9ba-3e8719b10cc1","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId 5b7d99e2-6c26-4806-8dda-90dcd0a5d431 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        '3b862de0-7cae-4a87-b9ba-3e8719b10cc1',
        '5b7d99e2-6c26-4806-8dda-90dcd0a5d431'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:216:29)

    console.log
      [2025-05-22 13:27:17.869] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "5b7d99e2-6c26-4806-8dda-90dcd0a5d431"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.872] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "correctCount": 2,
        "total": 2
      } Practice mode completed, sending final score

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_ended [
        {
          accessCode: 'PRACTICE1',
          score: 2,
          totalQuestions: 2,
          correct: 2,
          total: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      üëÄ DIRECT LISTENER: game_ended event received: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:216:21)

    console.log
      ‚úÖ Event received: game_ended {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      ‚úÖ Successfully received game_ended event: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:227:17)

    console.log
      Test completed successfully, disconnecting socket

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:232:17)

    console.log
      [2025-05-22 13:27:17.874] [32mINFO [0m [DisconnectHandler] {
        "socketId": "dLrqSHD1L4bCRtspAAAB",
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.875] [32mINFO [0m [DisconnectHandler] {
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "socketId": "dLrqSHD1L4bCRtspAAAB"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:17.876] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "practice-player-1",
          "socketId": "dLrqSHD1L4bCRtspAAAB"
        },
        "room": "live_PRACTICE1"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/projectorHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-22 13:27:18.171] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:18.180] [32mINFO [0m [ProjectorHandler] Projector joined room: projector_test-game-id

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:18.182] [32mINFO [0m [ProjectorHandler] Projector left room: projector_test-game-id

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/gamesApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-22 13:27:18.686] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:18.700] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:18.831] [31mERROR[0m [GameStateService] {
        "gameInstanceId": "game-123"
      } Game instance not found

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG response: 200 application/json; charset=utf-8 {"games":[{"id":"game-1","status":"pending","name":"Game 1"},{"id":"game-2","status":"active","name":"Game 2"}]}

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:370:21)

PASS tests/integration/questionApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-22 13:27:19.122] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.131] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.153] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error updating question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.158] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error deleting question

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/quizTemplateApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.413] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.416] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.417] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.421] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.423] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.445] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.446] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.453] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.455] [32mINFO [0m [Auth] {
        "authHeader": "Bearer invalid-token"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.456] [31mERROR[0m [Auth] {
        "error": {
          "name": "JsonWebTokenError",
          "message": "jwt malformed"
        }
      } Authentication error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.459] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.460] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.463] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.466] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.467] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.470] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.470] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.473] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.475] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.477] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.480] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.481] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.490] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.491] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.493] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error updating quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.497] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.500] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.501] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.504] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.505] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-22 13:27:19.506] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error deleting quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ3OTEzMjM5LCJleHAiOjE3NDc5MTY4Mzl9.TKy_oHDjoAbKTmazL3tVcq63YqQv-_9cMYl-B9-7-zo

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-22 13:27:19.508] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/teacherAuth.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-22 13:27:20.001] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/playerApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-22 13:27:20.256] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/quizTemplateService.test.ts
PASS tests/integration/lobbyBasic.test.ts
  ‚óè Console

    console.log
      Server listening on port 36824

      at Server.<anonymous> (tests/integration/lobbyBasic.test.ts:72:25)

    console.log
      Socket connected: OpQ6z5zMCf2kXVvBAAAB

      at Namespace.<anonymous> (tests/integration/lobbyBasic.test.ts:41:21)

    console.log
      Client connected

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:171:21)

    console.log
      Player Test Player 1 joining lobby TEST123

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:46:25)

    console.log
      Received participants list: {
        participants: [
          {
            id: 'OpQ6z5zMCf2kXVvBAAAB',
            username: 'Test Player 1',
            userId: 'test-player-1'
          }
        ],
        gameId: 'test-game-id',
        gameName: 'Test Game'
      }

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:181:21)

PASS tests/unit/questionService.test.ts
PASS tests/integration/basic-check.test.ts
PASS tests/unit/gameParticipantService.test.ts
PASS tests/unit/gameInstanceService.test.ts
PASS tests/integration/server.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-22 13:27:22.461] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/accessCodeGeneration.test.ts
PASS tests/unit/roomUtils.test.ts
PASS tests/unit/utils/testPathAliases.test.ts
PASS tests/setupTests.test.ts
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                             
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                            |   46.86 |    26.96 |   37.34 |   65.86 |                                                                                                                                                                               
 src                                 |    82.5 |     37.5 |      60 |    82.5 |                                                                                                                                                                               
  server.ts                          |    82.5 |     37.5 |      60 |    82.5 | 22,38,46-48,55,61-62                                                                                                                                                          
 src/api                             |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/api/v1                          |   52.26 |    33.84 |   75.55 |   52.45 |                                                                                                                                                                               
  gameControl.ts                     |   12.03 |        0 |       0 |   12.03 | 19-53,63-132,142-213,223-271                                                                                                                                                  
  gameTemplates.ts                   |   48.48 |    34.48 |     100 |   51.61 | 37-38,48,52-53,56-57,64-69,75-77,94-125                                                                                                                                       
  games.ts                           |    60.1 |    47.45 |   76.92 |   59.66 | 79-80,86-98,124-125,154-155,187-188,202-203,236-237,245-286,296-307,320-321,332-333,342-361,369-370,375-376                                                                   
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  players.ts                         |   76.74 |       50 |     100 |   76.19 | 15,55-63,76-77,89-90                                                                                                                                                          
  questions.ts                       |   74.74 |     47.5 |     100 |   76.59 | 17,35-36,54-55,82-83,111,120,130-135,151-152,164-165,172-173,191,203-204,218                                                                                                  
  quizTemplates.ts                   |   46.71 |    31.94 |      70 |   46.97 | 16,34-35,69-70,82-83,104-105,117-118,135,155-156,168-169,192-197,209-210,226-231,241-276,286-314,324-358                                                                      
  teachers.ts                        |      50 |       20 |      80 |   49.15 | 17,37-38,42-43,56-64,78-79,88-89,94-105,114-128                                                                                                                               
 src/config                          |      75 |        0 |      50 |      75 |                                                                                                                                                                               
  redis.ts                           |      75 |        0 |      50 |      75 | 7-8,23                                                                                                                                                                        
 src/core                            |   67.12 |    50.98 |   69.56 |   67.31 |                                                                                                                                                                               
  gameStateService.ts                |   67.12 |    50.98 |   69.56 |   67.31 | 74-95,106,116-117,158-159,201-202,218-219,226-228,238-239,288-289,309-310,331,367-368,379-407,425-426,435-436,447-458,462,471-472,492-494,498,501-502,529-535,543-544,568-569 
 src/core/services                   |   66.29 |    65.78 |   59.09 |   66.38 |                                                                                                                                                                               
  gameInstanceService.ts             |   86.36 |    95.45 |   77.77 |   85.93 | 107-108,236-249,325                                                                                                                                                           
  gameParticipantService.ts          |   92.53 |     91.3 |     100 |   92.42 | 81,87,103,156-157                                                                                                                                                             
  gameTemplateService.ts             |   16.66 |     5.55 |   18.18 |   16.66 | 44-77,104-222                                                                                                                                                                 
  questionService.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  quizTemplateService.ts             |   63.29 |    46.42 |   66.66 |   63.29 | 54,95-96,125,131,162-163,188,256,265,288-367                                                                                                                                  
  userService.ts                     |   18.86 |     6.25 |       0 |    19.6 | 41-170                                                                                                                                                                        
 src/db                              |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  prisma.ts                          |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/db/generated/client             |   92.06 |       50 |       0 |   92.06 |                                                                                                                                                                               
  index.js                           |   92.06 |       50 |       0 |   92.06 | 293-303                                                                                                                                                                       
 src/db/generated/client/runtime     |    33.2 |    19.78 |   28.66 |      62 |                                                                                                                                                                               
  library.js                         |    33.2 |    19.78 |   28.66 |      62 | 14,18-22,26,38-60,68,72-104,126-129                                                                                                                                           
 src/middleware                      |   86.48 |       60 |     100 |   85.71 |                                                                                                                                                                               
  auth.ts                            |   86.48 |       60 |     100 |   85.71 | 46-47,76,82,94                                                                                                                                                                
 src/sockets                         |    87.8 |    33.33 |   85.71 |    87.8 |                                                                                                                                                                               
  index.ts                           |    87.8 |    33.33 |   85.71 |    87.8 | 24-25,72,83,94                                                                                                                                                                
 src/sockets/handlers                |   77.54 |    58.87 |    91.3 |   77.33 |                                                                                                                                                                               
  connectionHandlers.ts              |     100 |       70 |     100 |     100 | 38                                                                                                                                                                            
  disconnectHandler.ts               |   94.11 |       70 |     100 |   94.11 | 65,76                                                                                                                                                                         
  gameHandler.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  lobbyHandler.ts                    |   69.81 |       30 |   85.71 |   69.81 | 62-67,72-77,82-93,138-139,170,194-198,204,214-215,250,264-265,275-281,298-299,305-315                                                                                         
  projectorHandler.ts                |   70.83 |      100 |      80 |   70.83 | 25-26,47-52                                                                                                                                                                   
  sharedAnswers.ts                   |   44.44 |        0 |       0 |   57.14 | 16-18                                                                                                                                                                         
  sharedGameFlow.ts                  |   97.95 |    76.92 |     100 |   97.82 | 80                                                                                                                                                                            
  sharedLeaderboard.ts               |   86.66 |    66.66 |      80 |    92.3 | 38                                                                                                                                                                            
  sharedLiveHandler.ts               |   74.63 |    58.33 |     100 |   73.43 | 46-51,133,179,207,219-225,234-245,253-264,276-278,293-295,322-327,338-344,350-356,360-366,388-394,404-405,424-430,439,443-444,465-466,473-474,487-488                         
  sharedScore.ts                     |      60 |       50 |     100 |    62.5 | 18-20                                                                                                                                                                         
  teacherControlHandler.ts           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  tournamentHandler.ts               |      75 |     62.5 |     100 |   74.32 | 38-40,57-59,72-74,82-84,93-94,118-120,142-144                                                                                                                                 
 src/sockets/handlers/game           |   76.48 |    72.72 |   95.23 |   76.29 |                                                                                                                                                                               
  disconnect.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  gameAnswer.ts                      |   68.46 |    77.19 |     100 |   68.46 | 69-73,82-86,98-100,104-108,111-115,138-143,163-164,229-230,244-261                                                                                                            
  index.ts                           |    73.8 |    42.85 |      75 |    72.5 | 44-46,50-52,63-65,91-92                                                                                                                                                       
  joinGame.ts                        |   80.68 |    74.28 |     100 |   80.68 | 44-50,69-72,100-101,117-120,184-186                                                                                                                                           
  requestNextQuestion.ts             |   83.63 |    72.09 |     100 |   82.69 | 29-30,34-36,45-46,147-148                                                                                                                                                     
  requestParticipants.ts             |   92.85 |        0 |     100 |     100 | 15                                                                                                                                                                            
 src/sockets/handlers/teacherControl |   48.02 |       25 |   86.36 |   47.92 |                                                                                                                                                                               
  disconnect.ts                      |   93.33 |      100 |     100 |   93.33 | 27                                                                                                                                                                            
  endGame.ts                         |   71.05 |    18.18 |     100 |   71.05 | 16-20,35-39,45-49,93-102,112                                                                                                                                                  
  helpers.ts                         |   63.46 |    51.85 |      75 |   63.46 | 19-20,32-33,52-53,59-60,112-113,128,133-141,147-148                                                                                                                           
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  joinDashboard.ts                   |    42.3 |    15.78 |     100 |    42.3 | 27-51,65-75,79-84,88-110,148-187,196-211,217-226                                                                                                                              
  lockAnswers.ts                     |   70.27 |    18.18 |     100 |   70.27 | 16-20,35-39,45-49,82-91,101                                                                                                                                                   
  pauseTimer.ts                      |    8.97 |        0 |      50 |    8.97 | 13-207                                                                                                                                                                        
  setQuestion.ts                     |   53.76 |    33.33 |     100 |   53.26 | 18-22,26-37,52-70,76-80,83-94,101,107-119,214-228                                                                                                                             
  startTimer.ts                      |    8.97 |        0 |      50 |    8.97 | 13-202                                                                                                                                                                        
  timerAction.ts                     |      75 |    54.28 |     100 |      75 | 20-25,29-34,49-54,60-65,126-132,162-163                                                                                                                                       
 src/sockets/handlers/tournament     |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/sockets/middleware              |   87.87 |       85 |     100 |    87.5 |                                                                                                                                                                               
  socketAuth.ts                      |   87.87 |       85 |     100 |    87.5 | 67,85,95-96                                                                                                                                                                   
 src/sockets/utils                   |   84.31 |    66.66 |     100 |   83.67 |                                                                                                                                                                               
  roomUtils.ts                       |   84.31 |    66.66 |     100 |   83.67 | 91-99,118-123,137-142,176-182                                                                                                                                                 
 src/utils                           |   89.79 |       52 |     100 |   89.58 |                                                                                                                                                                               
  logger.ts                          |   89.79 |       52 |     100 |   89.58 | 39,90,96,108,112                                                                                                                                                              
 tests                               |   82.71 |    73.91 |      80 |   83.11 |                                                                                                                                                                               
  testSetup.ts                       |   82.71 |    73.91 |      80 |   83.11 | 69-70,89-105,168-169,183                                                                                                                                                      
 tests/helpers                       |   80.95 |     37.5 |      50 |   78.94 |                                                                                                                                                                               
  generateTeacherToken.ts            |     100 |       25 |     100 |     100 | 3-5                                                                                                                                                                           
  jwt.ts                             |     100 |       50 |     100 |     100 | 3-5                                                                                                                                                                           
  serviceMocks.ts                    |      60 |      100 |      25 |      50 | 21-24                                                                                                                                                                         
 tests/support                       |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  testQuestions.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                               
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Summary of all failing tests
FAIL tests/integration/gameHandler.test.ts


  ‚óè Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/gameHandler.test.ts:246:27

      243     }
      244 });
      245 // Clean up test players
    ‚Üí 246 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `StudentProfile_id_fkey`

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/gameHandler.test.ts:246:9)


Test Suites: 1 failed, 26 passed, 27 total
Tests:       169 passed, 169 total
Snapshots:   0 total
Time:        82.255 s, estimated 83 s
Ran all test suites.
Error: Jest: Got error running globalTeardown - /home/aflesch/mathquest/app/backend/tests/globalTeardown.ts, reason: Cannot find module '@/config/redis'
Require stack:
- /home/aflesch/mathquest/app/backend/src/sockets/index.ts
- /home/aflesch/mathquest/app/backend/tests/globalTeardown.ts
- /home/aflesch/mathquest/app/backend/node_modules/jest-util/build/requireOrImportModule.js
- /home/aflesch/mathquest/app/backend/node_modules/jest-util/build/index.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/FailedTestsInteractiveMode.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/plugins/FailedTestsInteractive.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/watch.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/cli/index.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/index.js
- /home/aflesch/mathquest/app/backend/node_modules/jest-cli/build/run.js
- /home/aflesch/mathquest/app/backend/node_modules/jest-cli/build/index.js
- /home/aflesch/mathquest/app/backend/node_modules/jest-cli/bin/jest.js
- /home/aflesch/mathquest/app/backend/node_modules/jest/bin/jest.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)
    at Function._load (node:internal/modules/cjs/loader:1075:27)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:138:16)
    at Object.<anonymous> (/home/aflesch/mathquest/app/backend/src/sockets/index.ts:14:17)
    at Module._compile (node:internal/modules/cjs/loader:1565:14)
    at Module._compile (/home/aflesch/mathquest/app/backend/node_modules/pirates/lib/index.js:129:24)
    at node:internal/modules/cjs/loader:1708:10
    at Object.newLoader (/home/aflesch/mathquest/app/backend/node_modules/pirates/lib/index.js:134:7)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
    at Function._load (node:internal/modules/cjs/loader:1128:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:138:16)
    at Object.<anonymous> (/home/aflesch/mathquest/app/backend/tests/globalTeardown.ts:5:19)
    at Module._compile (node:internal/modules/cjs/loader:1565:14)
    at Module._compile (/home/aflesch/mathquest/app/backend/node_modules/pirates/lib/index.js:129:24)
    at node:internal/modules/cjs/loader:1708:10
    at Object.newLoader (/home/aflesch/mathquest/app/backend/node_modules/pirates/lib/index.js:134:7)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
    at Function._load (node:internal/modules/cjs/loader:1128:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:138:16)
    at requireOrImportModule (/home/aflesch/mathquest/app/backend/node_modules/jest-util/build/requireOrImportModule.js:44:28)
    at ScriptTransformer.requireAndTranspileModule (/home/aflesch/mathquest/app/backend/node_modules/@jest/transform/build/ScriptTransformer.js:798:66)
    at runGlobalHook (/home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/runGlobalHook.js:101:27)
    at runJest (/home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/runJest.js:374:5)
    at _run10000 (/home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/cli/index.js:343:7)
    at runCLI (/home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/cli/index.js:198:3)
    at Object.run (/home/aflesch/mathquest/app/backend/node_modules/jest-cli/build/run.js:130:37)
